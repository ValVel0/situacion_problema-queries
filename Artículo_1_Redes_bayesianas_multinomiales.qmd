---
title: "Artículo 1: Redes bayesianas multinomiales"
author: "Pedro Silva A01247217"
format:
   html:
     toc: true
     html-math-method: katex
     embed-resources: true
     self-contained-math: true
     df-print: kable
editor: source
---

## Artículo 1: Redes bayesianas multinomiales

# Librerias usadas

```{r}
library(tidyverse)
library(bnlearn)
```


# Cargando y creando la base de datos optima

```{r}
viaje <- read_csv("data/eod_2017/tviaje_eod2017/conjunto_de_datos/tviaje.csv") %>%
  select(id_soc, p5_3, p5_6, p5_7_7, p5_14_01, p5_14_07, p5_14_12, p5_14_14, p5_14_19, p5_14_20) %>%
  mutate(across(where(is.character), as.factor))  # Convertir character a factor

dem <- read_csv("data/eod_2017/tsdem_eod2017/conjunto_de_datos/tsdem.csv") %>%
  select(id_soc, sexo, edad, ent, niv) %>%
  mutate(across(where(is.character), as.factor))
```


```{r}
# Unir las tablas por id_soc
base_final <- viaje %>%
  left_join(dem, by = "id_soc")
```

```{r}
head(base_final)
```
```{r}
sum(is.na(base_final))
```


# Generando DAGS

DAG_1

```{r}
colnames(base_final) = c("id_soc", "p5_3", "p5_6", "p5_7_7", "p5_14_01", "p5_14_07", "p5_14_12", "p5_14_14", "p5_14_19", "p5_14_20", "sexo", "edad", "ent", "niv")
```

```{r}
dag_1 = model2network("[sexo][edad][niv][ent][p5_3|sexo:edad:niv][p5_6|sexo:edad:niv:ent][p5_7_7|sexo:edad:niv:ent][p5_14_01|p5_3:p5_6:p5_7_7][p5_14_07|p5_3:p5_6:p5_7_7][p5_14_12|p5_3:p5_6:p5_7_7][p5_14_14|p5_3:p5_6:p5_7_7][p5_14_19|p5_3:p5_6:p5_7_7][p5_14_20|p5_3:p5_6:p5_7_7]")
```

```{r}
dev.new(width=12, height=8)  
graphviz.plot(dag_1, shape = "ellipse")
```
```{r}
dag_1
```

DAG_2

```{r}
dag_2 = model2network("[sexo][edad][p5_3][ent][p5_6|ent][niv|sexo:edad][p5_7_7|p5_6][p5_14_01|p5_3:sexo:niv:p5_7_7][p5_14_07|p5_3:sexo:niv:p5_7_7][p5_14_12|p5_3:sexo:niv:p5_7_7][p5_14_14|p5_3:sexo:niv:p5_7_7][p5_14_19|p5_3:sexo:niv:p5_7_7][p5_14_20|p5_3:sexo:niv:p5_7_7]")
```

```{r}
dev.new(width=12, height=8)  
graphviz.plot(dag_2, shape = "ellipse")
```
```{r}
dag_2
```
DAG_3

```{r}
dag_3 = model2network("[sexo][edad][ent][niv|sexo:edad:ent][p5_7_7|ent][p5_6|p5_7_7][p5_3|niv:p5_6][p5_14_01|p5_3][p_14_07|p5_3][p_14_12|p5_3][p_14_14|p5_3][p_14_19|p5_3][p_14_20|p5_3]")
```

```{r}
dev.new(width=12, height=8)  
graphviz.plot(dag_3, shape = "ellipse")
```
```{r}
dag_3
```

best_dag
```{r}
best_dag = hc(base_final)
```

```{r}
dev.new(width=12, height=8)  
graphviz.plot(best_dag, shape = "ellipse")
```

Scores de cada una de las DAGs

```{r}
score(dag_1, data = base_final, type = "bic")
score(dag_1, data = base_final, type = "aic")
```

```{r}
score(dag_2, data = base_final, type = "bic")
score(dag_2, data = base_final, type = "aic")
```

```{r}
score(dag_3, data = base_final, type = "bic")
score(dag_3, data = base_final, type = "aic")
```

```{r}
score(best_dag, data = base_final, type = "bic")
score(best_dag, data = base_final, type = "aic")
```

